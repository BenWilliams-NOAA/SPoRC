% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_model_fits.R
\name{get_osa}
\alias{get_osa}
\title{Compute OSA residuals for composition data}
\usage{
get_osa(
  obs_mat,
  exp_mat,
  N = NULL,
  DM_theta = NULL,
  LN_Sigma = NULL,
  years,
  fleet,
  bins,
  comp_type,
  bin_label,
  comp_like = 0
)
}
\arguments{
\item{obs_mat}{Array of observed compositions, dimensioned by
\code{[region, year, bin, sex, fleet]}. May contain \code{NA}s, which are
removed when filtering by \code{years}.}

\item{exp_mat}{Array of expected compositions, dimensioned the same as
\code{obs_mat}. May contain \code{NA}s, which are removed when filtering by
\code{years}.}

\item{N}{Input (or effective if Multinomial) sample size. Dimensions depend on \code{comp_type}:
\itemize{
  \item \code{comp_type = 0} (aggregated): vector of length \code{n_years}.
  \item \code{comp_type = 1} (split by region and sex): array
    \code{[n_regions, n_years, n_sexes]}.
  \item \code{comp_type = 2} (split by region, joint by sex): matrix
    \code{[n_regions, n_years]}.
}}

\item{DM_theta}{Dirichlet-multinomial overdispersion parameter(s). Dimensions
must match \code{N}:
\itemize{
  \item aggregated: scalar
  \item split by sex: matrix \code{[n_regions, n_sexes]}
  \item joint by sex: vector of length \code{n_regions}
}}

\item{LN_Sigma}{Logistic-normal covariance matrix. Dimensions depend on
\code{comp_type}:
\itemize{
  \item aggregated: matrix \code{[n_bins, n_bins]}
  \item split by region and sex: array \code{[n_regions, n_bins, n_bins, n_sexes]}
  \item joint by sex: array \code{[n_regions, n_bins, n_bins]}
}
Use [get_logistN_Sigma()] to help construct this input.}

\item{years}{Vector of years to filter to. Must match dimensions of
\code{obs_mat} and \code{exp_mat}.}

\item{fleet}{Fleet identifier (character or numeric) to filter to.}

\item{bins}{Vector of age or length bin labels corresponding to the
composition categories.}

\item{comp_type}{Integer specifying how compositions are structured:
\itemize{
  \item 0 = aggregated across regions and sexes
  \item 1 = split by region and sex
  \item 2 = split by region, joint by sex
}}

\item{bin_label}{Character label describing whether bins represent ages or
lengths.}

\item{comp_like}{Integer specifying the likelihood type (defaults to 0):
\itemize{
  \item 0 = multinomial
  \item 1 = Dirichlet-multinomial
  \item 2â€“4 = logistic-normal variants
}}
}
\value{
A list with one element:
\describe{
  \item{res}{Data frame of OSA residuals. Columns include:
    \code{fleet}, \code{index_label}, \code{year}, \code{index},
    \code{resid}, \code{region}, \code{sex}, and \code{comp_type}.}
}
}
\description{
Formats observed and expected composition data and calculates one-step-ahead
(OSA) residuals using multinomial, Dirichlet-multinomial, or logistic-normal
likelihoods. This function is the main interface for residual diagnostics,
internally calling [run_osa()] to perform the residual calculations.
}
\seealso{
Other Model Diagnostics: 
\code{\link{do_jitter}()},
\code{\link{do_likelihood_profile}()},
\code{\link{do_retrospective}()},
\code{\link{do_runs_test}()},
\code{\link{get_catch_fits_plot}()},
\code{\link{get_comp_prop}()},
\code{\link{get_idx_fits}()},
\code{\link{get_idx_fits_plot}()},
\code{\link{get_model_rep_from_mcmc}()},
\code{\link{get_nLL_plot}()},
\code{\link{get_retrospective_plot}()},
\code{\link{get_retrospective_relative_difference}()},
\code{\link{plot_resids}()}
}
\concept{Model Diagnostics}
