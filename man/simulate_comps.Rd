% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Simulate_Population.R
\name{simulate_comps}
\alias{simulate_comps}
\title{Simulate Age or Length Compositions}
\usage{
simulate_comps(
  r,
  y,
  f,
  sim,
  Exp,
  ISS,
  AgeingError,
  comp_like,
  ln_theta,
  corr_pars,
  ln_theta_agg,
  corr_pars_agg,
  comp_type,
  n_sexes,
  n_regions,
  n_cat,
  Obs,
  age_or_len = 0
)
}
\arguments{
\item{r}{Integer. Region index.}

\item{y}{Integer. Year index.}

\item{f}{Integer. Fleet index.}

\item{sim}{Integer. Simulation iteration index.}

\item{Exp}{Array. Expected compositions (age or length) with dimensions [region, year, category, sex, fleet, sim].}

\item{ISS}{Array. Sample size (integer) for the Observed compositions with dimensions [region, year, sex, fleet, sim].}

\item{AgeingError}{Array. Ageing error matrix for each year, dimensions [year, category, category, sim].}

\item{comp_like}{Integer vector. Composition likelihood type per fleet: 0 = multinomial, 1 = Dirichlet-multinomial, 2-4 = logistic-normal.}

\item{ln_theta}{Array. Log-variance parameter for compositions per region, sex, and fleet, dimensions [region, sex, fleet].}

\item{corr_pars}{Array. Correlation parameters for logistic-normal likelihood, dimensions [region, sex, fleet, ?].}

\item{ln_theta_agg}{Numeric vector. Log-variance parameter for aggregated compositions per fleet.}

\item{corr_pars_agg}{Numeric vector. Correlation parameters for aggregated logistic-normal likelihood per fleet.}

\item{comp_type}{Integer array. Composition type: 0 = aggregated across regions, 1 = split by sex, 2 = joint across sexes, dimensions [year, fleet].}

\item{n_sexes}{Integer. Number of sexes.}

\item{n_regions}{Integer. Number of regions.}

\item{n_cat}{Integer. Number of categories (ages or lengths).}

\item{Obs}{Array. Observed compositions array to fill, same dimensions as `Exp`.}

\item{age_or_len}{Integer. Flag to indicate if ageing error should be applied: 0 = apply ageing error (for ages), 1 = do not apply (for lengths).}
}
\value{
Array of Observed compositions with the same dimensions as `Obs`, updated with simulated Observations.
}
\description{
Generates Observed fish compositions by age or length for a given region, year, fleet, and simulation iteration.
Supports multinomial, Dirichlet-multinomial, and logistic-normal likelihoods, with optional ageing error applied.
}
\details{
The function handles three cases based on `comp_type`:
1. Split by sex (comp_type = 1): compositions are simulated separately for each sex.
2. Joint compositions across sexes (comp_type = 2): compositions simulated jointly and multiplied by a kronecker matrix for logistic-normal or Dirichlet-multinomial likelihoods.
3. Aggregated across regions (comp_type = 0): only applied in the last region and averages across regions and sexes.

The function normalizes expected compositions, applies the selected likelihood (`comp_like`), and multiplies by `AgeingError` when applicable.
}
\keyword{internal}
