% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_model_fits.R
\name{run_osa}
\alias{run_osa}
\title{Internal function to compute OSA residuals for a single composition slice}
\usage{
run_osa(
  obs,
  exp,
  N = NULL,
  DM_theta = NULL,
  LN_Sigma = NULL,
  fleet,
  index,
  years,
  index_label,
  comp_like
)
}
\arguments{
\item{obs}{Matrix of observed compositions (rows = years, columns = bins)}

\item{exp}{Matrix of expected compositions (same shape as obs)}

\item{N}{Sample size for multinomial/Dirichlet-multinomial}

\item{DM_theta}{Dirichlet-multinomial overdispersion parameter(s)}

\item{LN_Sigma}{Logistic-normal covariance matrix}

\item{fleet}{Fleet identifier}

\item{index}{Vector of composition bins (last entry dropped for logistic-normal)}

\item{years}{Vector of years corresponding to rows of obs/exp}

\item{index_label}{Character describing ages or lengths}

\item{comp_like}{Integer specifying likelihood:
\describe{
  \item{0}{multinomial}
  \item{1}{Dirichlet-multinomial}
  \item{2-4}{logistic-normal variants}
}}
}
\value{
A list with one element:
\describe{
  \item{res}{Data frame of OSA residuals with columns fleet, index_label, year, index, resid}
}
}
\description{
Backend function used by [get_osa()] to calculate one-step-ahead (OSA) residuals
from observed and expected composition data.
}
\details{
For multinomial and Dirichlet-multinomial, observed proportions are scaled to counts.
For logistic-normal, bins with zeros are removed, compositions renormalized,
residuals computed in log-ratio space, and mapped back to original bins.
}
\keyword{internal}
