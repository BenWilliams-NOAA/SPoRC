<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Random Effects (Selectivity Example; Eastern Bering Sea Pollock)  • SPoRC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Random Effects (Selectivity Example; Eastern Bering Sea Pollock) ">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SPoRC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Random Effects (Selectivity Example; Eastern Bering Sea Pollock) </h1>
            
      

      <div class="d-none name"><code>n_single_region_ebs_pollock_randomeff_case_study.Rmd</code></div>
    </div>

    
    
<p>Several options are available to set up random effects in
<code>SPoRC</code>. In this vignette, we will demonstrate how fishery
selectivity random effects might be set up, using Eastern Bering Sea
(EBS) as a case study. We will first load in the relevant packages and
datasets.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chengmatt.github.io/SPoRC">SPoRC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code>SPoRC</code> framework allows flexible control over how
fishery selectivity random effects are modeled. In general, the
following arguments work together to define the random effects
structure:</p>
<ul>
<li>
<code>cont_tv_fish_sel</code>: form of continuous time-varying
selectivity for each fleet.</li>
<li>
<code>fishsel_pe_pars_spec</code>: process error parameter
estimation across regions and sexes.</li>
<li>
<code>fish_sel_devs_spec</code>: structure of selectivity deviations
across regions, sexes, and fleets.</li>
<li>
<code>corr_opt_semipar</code>: correlation structure options for
semi-parametric selectivity models.</li>
</ul>
<p>Additional arguments (<code>fish_sel_blocks</code>,
<code>fish_sel_model</code>, <code>fish_fixed_sel_pars_spec</code>,
<code>fish_q_blocks</code>, and <code>fish_q_spec</code>) provide
further control over blocks, functional forms, fixed effects, and
catchability. As an example, Fleet 1 is modeled with independent
year-to-year deviations on logistic selectivity parameters, estimating
all process error parameters, with no correlation suppression and full
estimation of deviations:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Fishsel_and_Q.html">Setup_Mod_Fishsel_and_Q</a></span><span class="op">(</span></span>
<span>  input_list           <span class="op">=</span> <span class="va">inputs</span>, </span>
<span>  fish_sel_model       <span class="op">=</span> <span class="st">"logist1_Fleet_1"</span>,</span>
<span>  cont_tv_fish_sel     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iid_Fleet_1"</span><span class="op">)</span>,</span>
<span>  fishsel_pe_pars_spec <span class="op">=</span> <span class="st">"est_all"</span>,</span>
<span>  corr_opt_semipar     <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  fish_sel_devs_spec   <span class="op">=</span> <span class="st">"est_all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this vignette, we extend the single-region pollock example to
evaluate different random effects structures for fishery selectivity. To
do this, we define a wrapper function that constructs the input list for
the Eastern Bering Sea pollock model, allowing the user to specify four
arguments that control the structure of selectivity random effects. By
iterating over combinations of these options, we can investigate how
different assumptions about selectivity-related random effects influence
model fit and inference.</p>
<p>We keep survey selectivity fixed for simplicity (to focus the
comparison on the fishery), and use the Laplace approximation to
integrate out the random effects. The setup for recruitment, mortality,
biological processes, and survey indices follows the earlier vignette
“Setting up a Single Region Model (Eastern Bering Sea Pollock)”, so here
we only highlight the sections that differ.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Setup Single-Region Population Model for EBS Pollock</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Constructs a single-region population model input list, tailored to the</span></span>
<span><span class="co">#' \code{sgl_rg_ebswp_data} dataset. This function initializes dimensions,</span></span>
<span><span class="co">#' recruitment, natural mortality, biologicals, movement, tagging, catch,</span></span>
<span><span class="co">#' fishery indices and compositions, survey indices and compositions,</span></span>
<span><span class="co">#' selectivity and catchability, and component weighting.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param cont_tv_fish_sel Character vector. Whether to estimate continuous</span></span>
<span><span class="co">#' time-varying fishery selectivit (see \code{\link{Setup_Mod_FishIdx_and_Comps}}).</span></span>
<span><span class="co">#' @param fishsel_pe_pars_spec Character vector. Specification for penalized</span></span>
<span><span class="co">#' likelihood parameters for fishery selectivity deviations (see \code{\link{Setup_Mod_FishIdx_and_Comps}}).</span></span>
<span><span class="co">#' @param corr_opt_semipar Character vector. Correlation options for</span></span>
<span><span class="co">#' semi-parametric selectivity (see \code{\link{Setup_Mod_FishIdx_and_Comps}}).</span></span>
<span><span class="co">#' @param fish_sel_devs_spec Character vector. Specification of fishery</span></span>
<span><span class="co">#' selectivity deviations to be estimated (see \code{\link{Setup_Mod_FishIdx_and_Comps}}).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' The function relies on the global dataset \code{sgl_rg_ebswp_data} to provide</span></span>
<span><span class="co">#' years, ages, weight-at-age, maturity-at-age, observed catches, fishery and</span></span>
<span><span class="co">#' survey indices, age and length compositions, and other required inputs.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' The model is configured for:</span></span>
<span><span class="co">#' - one region</span></span>
<span><span class="co">#' - one sex</span></span>
<span><span class="co">#' - one fishery fleet</span></span>
<span><span class="co">#' - three survey fleets</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Natural mortality (\eqn{M}) is fixed at:</span></span>
<span><span class="co">#' - 0.9 for age-1,</span></span>
<span><span class="co">#' - 0.45 for age-2,</span></span>
<span><span class="co">#' - 0.3 for age-3+.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Recruitment is modeled using a Beverton–Holt stock–recruitment function</span></span>
<span><span class="co">#' with fixed steepness. </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Selectivity and catchability are parameterized separately for fishery and</span></span>
<span><span class="co">#' survey fleets, with user control over random effects and correlation</span></span>
<span><span class="co">#' structure for fishery selectivity deviations.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A fully specified model input list to pass onto subsequent model fitting functions.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @seealso</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_Dim}}, \code{\link{Setup_Mod_Rec}},</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_Biologicals}}, \code{\link{Setup_Mod_Movement}},</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_Tagging}}, \code{\link{Setup_Mod_Catch_and_F}},</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_FishIdx_and_Comps}},</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_SrvIdx_and_Comps}},</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_Fishsel_and_Q}}, \code{\link{Setup_Mod_Srvsel_and_Q}},</span></span>
<span><span class="co">#' \code{\link{Setup_Mod_Weighting}}</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">pol_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cont_tv_fish_sel</span>, </span>
<span>                      <span class="va">fishsel_pe_pars_spec</span>,</span>
<span>                      <span class="va">corr_opt_semipar</span>, </span>
<span>                      <span class="va">fish_sel_devs_spec</span></span>
<span>                      <span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co">## Initialize model dimensions and data list----</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Dim.html">Setup_Mod_Dim</a></span><span class="op">(</span></span>
<span>    years <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">years</span>,</span>
<span>    <span class="co"># vector of years</span></span>
<span>    ages <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ages</span>,</span>
<span>    <span class="co"># vector of ages</span></span>
<span>    lens <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    <span class="co"># number of lengths</span></span>
<span>    n_regions <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># number of regions</span></span>
<span>    n_sexes <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># number of sexes</span></span>
<span>    n_fish_fleets <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># number of fishery fleets</span></span>
<span>    n_srv_fleets <span class="op">=</span> <span class="fl">3</span>, <span class="co"># number of survey fleets</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">inv_steepness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="op">(</span><span class="va">s</span> <span class="op">-</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup recruitment stuff (using defaults for other stuff)</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Rec.html">Setup_Mod_Rec</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>    <span class="co"># Model options</span></span>
<span>    do_rec_bias_ramp <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="co"># do bias ramp (0 == don't do bias ramp, 1 == do bias ramp)</span></span>
<span>    sigmaR_switch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># when to switch from early to late sigmaR (switch in first year)</span></span>
<span>    ln_sigmaR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Starting values for early and late sigmaR</span></span>
<span>    rec_model <span class="op">=</span> <span class="st">"bh_rec"</span>,</span>
<span>    <span class="co"># recruitment model</span></span>
<span>    steepness_h <span class="op">=</span> <span class="fu">inv_steepness</span><span class="op">(</span><span class="fl">0.623013</span><span class="op">)</span>,</span>
<span>    h_spec <span class="op">=</span> <span class="st">"fix"</span>,</span>
<span>    <span class="co"># fixing steepness</span></span>
<span>    sigmaR_spec <span class="op">=</span> <span class="st">"fix"</span>,</span>
<span>    <span class="co"># fix early sigmaR and late sigmaR</span></span>
<span>    init_age_strc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ln_global_R0 <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    t_spawn <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    equil_init_age_strc <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup a fixed natural mortality array for use</span></span>
<span>  <span class="va">fix_natmort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">fix_natmort</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> <span class="co"># age 1 M</span></span>
<span>  <span class="va">fix_natmort</span><span class="op">[</span>,,<span class="fl">2</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.45</span> <span class="co"># age 2 M</span></span>
<span>  <span class="va">fix_natmort</span><span class="op">[</span>,,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.3</span> <span class="co"># age 3+ M</span></span>
<span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Biologicals.html">Setup_Mod_Biologicals</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>    <span class="co"># Data inputs</span></span>
<span>    WAA <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">WAA</span>,</span>
<span>    MatAA <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">MatAA</span>,</span>
<span></span>
<span>    <span class="co"># Model options</span></span>
<span>    <span class="co"># mean and sd for M prior</span></span>
<span>    fit_lengths <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="co"># don't fit length compositions</span></span>
<span>    M_spec <span class="op">=</span> <span class="st">"fix"</span>,</span>
<span>    <span class="co"># fixing natural mortality</span></span>
<span>    Fixed_natmort <span class="op">=</span> <span class="va">fix_natmort</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup movement stuff (using defaults for other stuff)</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Movement.html">Setup_Mod_Movement</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    use_fixed_movement <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Fixed_Movement <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    do_recruits_move <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup tagging stuff</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Tagging.html">Setup_Mod_Tagging</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>, UseTagging <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Catch_and_F.html">Setup_Mod_Catch_and_F</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>    <span class="co"># Data inputs</span></span>
<span>    ObsCatch <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsCatch</span>,</span>
<span>    Catch_Type <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">Catch_Type</span>,</span>
<span>    UseCatch <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">UseCatch</span>,</span>
<span></span>
<span>    <span class="co"># Model options</span></span>
<span>    Use_F_pen <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># whether to use f penalty, == 0 don't use, == 1 use</span></span>
<span>    sigmaC_spec <span class="op">=</span> <span class="st">"fix"</span>,</span>
<span>    <span class="co"># fixing catch standard deviation</span></span>
<span>    ln_sigmaC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># starting / fixed value for catch standard deviation</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_FishIdx_and_Comps.html">Setup_Mod_FishIdx_and_Comps</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># data inputs</span></span>
<span>    ObsFishIdx <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsFishIdx</span>,</span>
<span>    ObsFishIdx_SE <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsFishIdx_SE</span>,</span>
<span>    UseFishIdx <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">UseFishIdx</span>,</span>
<span>    ObsFishAgeComps <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsFishAgeComps</span>,</span>
<span>    UseFishAgeComps <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">UseFishAgeComps</span>,</span>
<span>    ISS_FishAgeComps <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ISS_FishAgeComps</span>,</span>
<span>    ObsFishLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA_real_</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">lens</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    UseFishLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ISS_FishLenComps <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>    <span class="co"># Model options</span></span>
<span>    fish_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biom"</span><span class="op">)</span>,</span>
<span>    <span class="co"># indices for fishery</span></span>
<span>    FishAgeComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span><span class="op">)</span>,</span>
<span>    <span class="co"># age comp likelihoods for fishery fleet</span></span>
<span>    FishLenComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>    <span class="co"># length comp likelihoods for fishery</span></span>
<span>    FishAgeComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_Year_1-terminal_Fleet_1"</span><span class="op">)</span>,</span>
<span>    <span class="co"># age comp structure for fishery</span></span>
<span>    FishLenComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Year_1-terminal_Fleet_1"</span><span class="op">)</span></span>
<span>    <span class="co"># length comp structure for fishery</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup survey indices and compositions</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_SrvIdx_and_Comps.html">Setup_Mod_SrvIdx_and_Comps</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>    <span class="co"># data inputs</span></span>
<span>    ObsSrvIdx <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsSrvIdx</span>,</span>
<span>    ObsSrvIdx_SE <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsSrvIdx_SE</span>,</span>
<span>    UseSrvIdx <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">UseSrvIdx</span>,</span>
<span>    ObsSrvAgeComps <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ObsSrvAgeComps</span>,</span>
<span>    ISS_SrvAgeComps <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">ISS_SrvAgeComps</span>,</span>
<span>    UseSrvAgeComps <span class="op">=</span> <span class="va">sgl_rg_ebswp_data</span><span class="op">$</span><span class="va">UseSrvAgeComps</span>,</span>
<span>    ObsSrvLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA_real_</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">lens</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    UseSrvLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ISS_SrvLenComps <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>    <span class="co"># Model options</span></span>
<span>    srv_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biom"</span>, <span class="st">"biom"</span>, <span class="st">"biom"</span><span class="op">)</span>,</span>
<span>    <span class="co"># abundance and biomass for survey fleet 1, 2, and 3</span></span>
<span>    SrvAgeComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span><span class="op">)</span>,</span>
<span>    <span class="co"># survey age composition likelihood for survey fleet 1, 2, and 3</span></span>
<span>    SrvLenComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"none"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>    <span class="co">#  survey length composition likelihood for survey fleet 1, 2, and 3</span></span>
<span>    SrvAgeComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"agg_Year_1-terminal_Fleet_1"</span>,</span>
<span>      <span class="st">"agg_Year_1-terminal_Fleet_2"</span>,</span>
<span>      <span class="st">"none_Year_1-terminal_Fleet_3"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># survey age comp type</span></span>
<span></span>
<span>    SrvLenComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"none_Year_1-terminal_Fleet_1"</span>,</span>
<span>      <span class="st">"none_Year_1-terminal_Fleet_2"</span>,</span>
<span>      <span class="st">"none_Year_1-terminal_Fleet_3"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># survey length comp type</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Setup fishery selectivity and catchability</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Fishsel_and_Q.html">Setup_Mod_Fishsel_and_Q</a></span><span class="op">(</span></span>
<span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>    <span class="co"># Model options (NOTE: Iterating Different Fishery Selectivity Random Effects Here!)</span></span>
<span>    cont_tv_fish_sel <span class="op">=</span> <span class="va">cont_tv_fish_sel</span>,  <span class="co"># fishery selectivity, whether continuous time-varying</span></span>
<span>    fishsel_pe_pars_spec <span class="op">=</span> <span class="va">fishsel_pe_pars_spec</span>, <span class="co"># doing penalized likelihood for selex devs</span></span>
<span>    fish_sel_devs_spec <span class="op">=</span> <span class="va">fish_sel_devs_spec</span>, <span class="co"># estimating all sel devs</span></span>
<span>    corr_opt_semipar <span class="op">=</span> <span class="va">corr_opt_semipar</span>, <span class="co"># correlation options</span></span>
<span></span>
<span>    <span class="co"># fishery selectivity blocks</span></span>
<span>    fish_sel_blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span><span class="op">)</span>,</span>
<span>    <span class="co"># fishery selectivity form</span></span>
<span>    fish_sel_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logist1_Fleet_1"</span><span class="op">)</span>,</span>
<span>    <span class="co"># fishery catchability blocks</span></span>
<span>    fish_q_blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span><span class="op">)</span>,</span>
<span>    <span class="co"># whether to estiamte all fixed effects for fishery selectivity</span></span>
<span>    fish_fixed_sel_pars_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span><span class="op">)</span>,</span>
<span>    <span class="co"># whether to estiamte all fixed effects for fishery catchability</span></span>
<span>    fish_q_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup survey selectivity and catchability</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Srvsel_and_Q.html">Setup_Mod_Srvsel_and_Q</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>    <span class="co"># Model options</span></span>
<span>    <span class="co"># survey selectivity blocks</span></span>
<span>    srv_sel_blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, <span class="st">"none_Fleet_2"</span>, <span class="st">"none_Fleet_3"</span><span class="op">)</span>,</span>
<span>    <span class="co"># survey selectivity form</span></span>
<span>    srv_sel_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"logist1_Fleet_1"</span>,</span>
<span>      <span class="st">"logist1_Fleet_2"</span>,</span>
<span>      <span class="st">"logist1_Fleet_3"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># survey catchability blocks</span></span>
<span>    srv_q_blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, <span class="st">"none_Fleet_2"</span>, <span class="st">"none_Fleet_3"</span><span class="op">)</span>,</span>
<span>    <span class="co"># whether to estiamte all fixed effects for survey selectivity</span></span>
<span>    srv_fixed_sel_pars_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="st">"est_all"</span>, <span class="st">"est_shared_f_2"</span><span class="op">)</span>,</span>
<span>    <span class="co"># whether to estiamte all fixed effects for survey catchability</span></span>
<span>    srv_q_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="st">"est_all"</span>, <span class="st">"est_all"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Weighting.html">Setup_Mod_Weighting</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    Wt_Catch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_FishIdx <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_SrvIdx <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_Rec <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_F <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_Tagging <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    Wt_FishAgeComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Wt_FishLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Wt_SrvAgeComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                      <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                      <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Wt_SrvLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                      <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                      <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once the function <code>pol_model()</code> is defined, we can explore
alternative random effects structures by iterating across argument
combinations. For illustration, we define a small set of candidate
models that vary only in the specification of fishery selectivity random
effects:</p>
<ol style="list-style-type: decimal">
<li>Constant selectivity (no random effects),</li>
<li>iid selectivity (random effects on parameters),</li>
<li>Random walk selectivity (random effects on parameters),</li>
<li>Two-dimensional autoregressive selectivity (year × age; random
effects are semi-parametric),</li>
<li>Three-dimensional autoregressive selectivity (year × age × cohort;
random effects are semi-parametric),</li>
<li>Independent deviations (random effects are semi-parametric).</li>
</ol>
<p>The dataframe below specifies the argument settings for each
scenario.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># models to iterate through</span></span>
<span><span class="va">pol_model_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  cont_tv_fish_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, <span class="st">"iid_Fleet_1"</span>, <span class="st">"rw_Fleet_1"</span>, <span class="st">"2dar1_Fleet_1"</span>, <span class="st">"3dcond_Fleet_1"</span>, <span class="st">"3dcond_Fleet_1"</span><span class="op">)</span>,</span>
<span>  fishsel_pe_pars_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fish_sel_devs_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  corr_opt_semipar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>, <span class="st">"corr_zero_y_b_c"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can now loop through each row to generate the model inputs, fit
the model using Laplace approximation, and store the results. The model
fitting process can take a while!</p>
<p><strong>Note</strong>: the <code>random</code> argument specifies
which parameters should be treated as random effects in the Laplace
approximation. In this case, it is set to <code>"ln_fishsel_devs"</code>
whenever selectivity deviations are modeled as random; otherwise, it is
<code>NULL.</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># model storage</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop through models</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pol_model_var</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># if selectivity deviations should be treated as random</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">pol_model_var</span><span class="op">$</span><span class="va">cont_tv_fish_sel</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span> <span class="va">random</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">else</span> <span class="va">random</span> <span class="op">&lt;-</span> <span class="st">"ln_fishsel_devs"</span></span>
<span></span>
<span>  <span class="co"># get input list</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu">pol_model</span><span class="op">(</span>cont_tv_fish_sel <span class="op">=</span> <span class="va">pol_model_var</span><span class="op">$</span><span class="va">cont_tv_fish_sel</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                          fishsel_pe_pars_spec <span class="op">=</span> <span class="va">pol_model_var</span><span class="op">$</span><span class="va">fishsel_pe_pars_spec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                          fish_sel_devs_spec <span class="op">=</span> <span class="va">pol_model_var</span><span class="op">$</span><span class="va">fish_sel_devs_spec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                          corr_opt_semipar <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pol_model_var</span><span class="op">$</span><span class="va">corr_opt_semipar</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="cn">NULL</span> <span class="kw">else</span> <span class="va">pol_model_var</span><span class="op">$</span><span class="va">corr_opt_semipar</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>                          <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># extract out lists updated with helper functions</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">data</span></span>
<span>  <span class="va">parameters</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">par</span></span>
<span>  <span class="va">mapping</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">map</span></span>
<span></span>
<span>  <span class="co"># Fit model</span></span>
<span>  <span class="va">ebswp_rtmb_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                                <span class="va">parameters</span>,</span>
<span>                                <span class="va">mapping</span>,</span>
<span>                                random <span class="op">=</span> <span class="va">random</span>,</span>
<span>                                newton_loops <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">ebswp_rtmb_model</span><span class="op">$</span><span class="va">sdrep</span> <span class="op">&lt;-</span> <span class="fu">RTMB</span><span class="fu">::</span><span class="fu">sdreport</span><span class="op">(</span><span class="va">ebswp_rtmb_model</span><span class="op">)</span></span>
<span>  <span class="va">sdrep</span> <span class="op">&lt;-</span> <span class="va">ebswp_rtmb_model</span><span class="op">$</span><span class="va">sdrep</span></span>
<span>  <span class="va">rep</span> <span class="op">&lt;-</span> <span class="va">ebswp_rtmb_model</span><span class="op">$</span><span class="va">rep</span></span>
<span>  <span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ebswp_rtmb_model</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># end i loop</span></span></code></pre></div>
<p>After fitting the models, we can summarize and compile the results to
compare how alternative random effects structures influence model
estimates and inference. In this example, we focus on differences in
recruitment, spawning stock biomass, and fishery selectivity
estimates.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"constant"</span>, <span class="st">"iid_p"</span>, <span class="st">"rw_p"</span>, <span class="st">"2dar1_sp"</span>, <span class="st">"3dgmrf_sp"</span>, <span class="st">"iid_sp"</span><span class="op">)</span></span>
<span><span class="va">fishsel_all_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># empty dataframe to bind to</span></span>
<span><span class="va">ts_all_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># empty dataframe to bind to</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Get recruitment time-series</span></span>
<span>  <span class="va">rec_series</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>se <span class="op">=</span> <span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sdrep</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sdrep</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="st">'log(Rec)'</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rec_series</span><span class="op">$</span><span class="va">Par</span> <span class="op">&lt;-</span> <span class="st">"Recruitment"</span></span>
<span>  <span class="va">rec_series</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="va">model_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Get SSB time-series</span></span>
<span>  <span class="va">ssb_series</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>se <span class="op">=</span> <span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sdrep</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sdrep</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="st">'log(SSB)'</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ssb_series</span><span class="op">$</span><span class="va">Par</span> <span class="op">&lt;-</span> <span class="st">"Spawning Stock Biomass"</span></span>
<span>  <span class="va">ssb_series</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="va">model_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Get fishery selectivity estimates</span></span>
<span>  <span class="va">fishsel_df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">fish_sel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Age <span class="op">=</span> <span class="va">Var3</span>, Sex <span class="op">=</span> <span class="va">Var4</span>, Fleet <span class="op">=</span> <span class="va">Var5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>           Year <span class="op">=</span> <span class="va">Year</span> <span class="op">+</span> <span class="fl">1963</span><span class="op">)</span></span>
<span>  <span class="va">fishsel_df</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="va">model_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># bind together</span></span>
<span>  <span class="va">ts_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ssb_series</span>,<span class="va">rec_series</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Year</span> <span class="op">+</span> <span class="fl">1963</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">ts_all_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ts_all_df</span>, <span class="va">ts_df</span><span class="op">)</span></span>
<span>  <span class="va">fishsel_all_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">fishsel_df</span>, <span class="va">fishsel_all_df</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># end i loop</span></span>
<span></span>
<span><span class="co"># Refactor to order models</span></span>
<span><span class="va">fishsel_all_df</span> <span class="op">&lt;-</span> <span class="va">fishsel_all_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"constant"</span>, <span class="st">"iid_p"</span>, <span class="st">"rw_p"</span>, <span class="st">"iid_sp"</span>, <span class="st">"2dar1_sp"</span>, <span class="st">"3dgmrf_sp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts_df</span> <span class="op">&lt;-</span> <span class="va">ts_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"constant"</span>, <span class="st">"iid_p"</span>, <span class="st">"rw_p"</span>, <span class="st">"iid_sp"</span>, <span class="st">"2dar1_sp"</span>, <span class="st">"3dgmrf_sp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Inspecting recruitment, the time series are generally consistent
across models in both magnitude and trend. Spawning stock biomass
estimates are also similar among models, though terminal year estimates
differ slightly: the three-dimensional (<code>3d</code>) and parametric
<code>iid</code> selectivity option generally yields the lowest biomass
estimates, while the <code>constant</code> selectivity option produces
the highest.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span> <span class="co"># colors</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ts_all_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">value</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">value</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="va">value</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span><span class="op">)</span>,</span>
<span>                      color <span class="op">=</span> <span class="va">Model</span>, fill <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_ribbon(alpha = 0.3, color = NA) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Par</span>, scales <span class="op">=</span> <span class="st">'free'</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.085</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Year'</span>, y <span class="op">=</span> <span class="st">'Value'</span>, color <span class="op">=</span> <span class="st">'Model'</span>, fill <span class="op">=</span> <span class="st">'Model'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/n_ebs_pol_re.png"></p>
<p>Examining fishery selectivity, the <code>iid</code> and
<code>2dar1</code> options are broadly similar, although
<code>2dar1</code> shows more structure at older ages due to correlation
constraints, whereas <code>iid</code> deviations tend to revert to the
mean when data are sparse. By contrast, the <code>3d</code> option
exhibits pronounced cohort variability (diagonal patterns) and maintains
selectivity patterns at older, less-informed ages through
correlation-based smoothing. Due to the assumption of parametric
selectivity, both the <code>iid_p</code> and <code>rw_p</code>
selectivity options appear relatively different (i.e., constrained to
remain logistic).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fishsel_all_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Age</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Model</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Year'</span>, y <span class="op">=</span> <span class="st">'Age'</span>, fill <span class="op">=</span> <span class="st">'Relative Selectivity'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/n_fishsel_re.png"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
