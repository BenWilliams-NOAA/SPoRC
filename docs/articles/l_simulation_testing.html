<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation Testing (Cross and Self Tests) â€¢ SPoRC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation Testing (Cross and Self Tests)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SPoRC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation Testing (Cross and Self Tests)</h1>
            
      

      <div class="d-none name"><code>l_simulation_testing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simulation-cross-testing-in-sporc">Simulation Cross-Testing in <code>SPoRC</code><a class="anchor" aria-label="anchor" href="#simulation-cross-testing-in-sporc"></a>
</h2>
<p>Simulation testing stock assessment models is integral to evaluating
robustness and understanding how models perform under model
misspecification. The <code>SPoRC</code> framework supports simulation
testing in three forms:<br>
- Self-testing: the estimation model (EM) has the same structure as the
operating model (OM).<br>
- Cross-testing: the EM differs structurally from the OM, allowing
assessment of bias and sensitivity to incorrect assumptions.<br>
- Closed loop simulations (see Closed Loop Simulations vignette
example).</p>
<p>In this first section of the vignette, we present a cross-test
example. The operating model (OM; simulated truth) assumes a logistic
selectivity curve for the fishery, while the estimation model
(<code>SPoRC</code>; EM) incorrectly specifies a dome-shaped (gamma)
selectivity curve.</p>
<p>The OM defines the biological processes, fishing dynamics, survey
structure, and recruitment assumptions. Unless otherwise noted, the OM
observation model uses default settings:</p>
<ul>
<li>Composition Input Sample Size = 100, with Multinomial sampling
(Fishery and Survey)</li>
<li>Survey index SD = 0.2, with lognormal observations</li>
<li>Catch SD = 0.02, with lognormal observations</li>
</ul>
<div class="section level3">
<h3 id="define-model-dimensions">Define Model Dimensions<a class="anchor" aria-label="anchor" href="#define-model-dimensions"></a>
</h3>
<p>We start by defining the structural dimensions of the operating
model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Dim.html">Setup_Sim_Dim</a></span><span class="op">(</span></span>
<span>  n_sims        <span class="op">=</span> <span class="fl">50</span>,  <span class="co"># number of simulations</span></span>
<span>  n_yrs         <span class="op">=</span> <span class="fl">30</span>,  <span class="co"># number of years</span></span>
<span>  n_regions     <span class="op">=</span> <span class="fl">1</span>,   <span class="co"># single region</span></span>
<span>  n_ages        <span class="op">=</span> <span class="fl">10</span>,  <span class="co"># number of ages</span></span>
<span>  n_lens        <span class="op">=</span> <span class="cn">NULL</span>,<span class="co"># no length structure</span></span>
<span>  n_sexes       <span class="op">=</span> <span class="fl">1</span>,   <span class="co"># single sex</span></span>
<span>  n_fish_fleets <span class="op">=</span> <span class="fl">1</span>,   <span class="co"># one fishery fleet</span></span>
<span>  n_srv_fleets  <span class="op">=</span> <span class="fl">1</span>    <span class="co"># one survey fleet</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create storage containers</span></span>
<span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Containers.html">Setup_Sim_Containers</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fishing-processes">Fishing Processes<a class="anchor" aria-label="anchor" href="#fishing-processes"></a>
</h3>
<p>The fishery selectivity in the OM is logistic, centered around age
5.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Fishing.html">Setup_Sim_Fishing</a></span><span class="op">(</span>sim_list <span class="op">=</span> <span class="va">sim_list</span>, <span class="co"># update simulate list</span></span>
<span>                              <span class="co"># Logistic selectivity</span></span>
<span>                              fish_sel_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>                                n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span>,</span>
<span>                                      dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>,</span>
<span>                                              <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>                              <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="survey-processes">Survey Processes<a class="anchor" aria-label="anchor" href="#survey-processes"></a>
</h3>
<p>We specify survey selectivity as logistic, centered around age 3.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Survey.html">Setup_Sim_Survey</a></span><span class="op">(</span></span>
<span>  sim_list <span class="op">=</span> <span class="va">sim_list</span>,</span>
<span>  <span class="co"># Logistic selectivity</span></span>
<span>  srv_sel_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span>,</span>
<span>          dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>,</span>
<span>                  <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_srv</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="biological-dynamics">Biological Dynamics<a class="anchor" aria-label="anchor" href="#biological-dynamics"></a>
</h3>
<p>Biological parameters are set for natural mortality, maturity-at-age,
and weight-at-age. These values are relatively arbitrary and are
specified to generically represent a fairly short-lived species.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Biologicals.html">Setup_Sim_Biologicals</a></span><span class="op">(</span></span>
<span>  sim_list <span class="op">=</span> <span class="va">sim_list</span>, <span class="co"># simualtion list</span></span>
<span>  natmort_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0.3</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>,</span>
<span>                                                                    <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># natural mortality</span></span>
<span>  WAA_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span>,</span>
<span>                                                   dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># weight at age</span></span>
<span>  WAA_fish_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span>,</span>
<span>                                                        dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># fishery weight at age</span></span>
<span>  WAA_srv_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span>,</span>
<span>                                                       dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># survey weight at age</span></span>
<span>  MatAA_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span>,</span>
<span>                                                     dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># maturity at age</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tagging-and-movement">Tagging and Movement<a class="anchor" aria-label="anchor" href="#tagging-and-movement"></a>
</h3>
<p>For this example, tagging is disabled and no movement is modeled.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Tagging.html">Setup_Sim_Tagging</a></span><span class="op">(</span></span>
<span>  sim_list <span class="op">=</span> <span class="va">sim_list</span>, <span class="co"># simulation list</span></span>
<span>  UseTagging <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No Movement</span></span>
<span><span class="va">sim_list</span><span class="op">$</span><span class="va">Movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_ages</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recruitment">Recruitment<a class="anchor" aria-label="anchor" href="#recruitment"></a>
</h3>
<p>Recruitment is modeled with mean recruitment dynamics, where
<code>R0_input</code> is the mean recruitment parameter centered at a
value of 5.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Sim_Rec.html">Setup_Sim_Rec</a></span><span class="op">(</span></span>
<span>  sim_list <span class="op">=</span> <span class="va">sim_list</span>,</span>
<span>  R0_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">5</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># R0</span></span>
<span>  ln_sigmaR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  recruitment_opt <span class="op">=</span> <span class="st">'mean_rec'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-the-operating-model">Run the Operating Model<a class="anchor" aria-label="anchor" href="#run-the-operating-model"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Simulate_Pop_Static.html">Simulate_Pop_Static</a></span><span class="op">(</span>sim_list <span class="op">=</span> <span class="va">sim_list</span>, output_path <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># get simulated datasets</span></span></code></pre></div>
<p>The object <code>sim_obj</code> contains the simulated population,
fishery, and survey data ready to pass to the EM for cross-testing.</p>
</div>
<div class="section level3">
<h3 id="define-estimation-model">Define Estimation Model<a class="anchor" aria-label="anchor" href="#define-estimation-model"></a>
</h3>
<p>After simulating the operating model (OM), we can set up the
estimation model (EM) in <code>SPoRC</code>.<br>
In this cross-test, the EM incorrectly assumes a dome-shaped (gamma)
fishery selectivity,<br>
even though the OM used logistic selectivity. In general, EM settings
are identical to the OM, except for fishery selectivity.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setup_em</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim_obj</span>, <span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Extract simulation data for current year and replicate</span></span>
<span>  <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulation_data_to_SPoRC.html">simulation_data_to_SPoRC</a></span><span class="op">(</span>sim_env <span class="op">=</span> <span class="va">sim_obj</span>, y <span class="op">=</span> <span class="va">sim_obj</span><span class="op">$</span><span class="va">n_years</span>, sim <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Setup model dimensions</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Dim.html">Setup_Mod_Dim</a></span><span class="op">(</span></span>
<span>    years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sim_obj</span><span class="op">$</span><span class="va">n_years</span>,</span>
<span>    ages <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sim_obj</span><span class="op">$</span><span class="va">n_ages</span>,</span>
<span>    lens <span class="op">=</span> <span class="va">sim_obj</span><span class="op">$</span><span class="va">n_lens</span>,</span>
<span>    n_regions <span class="op">=</span> <span class="va">sim_obj</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>    n_sexes <span class="op">=</span> <span class="va">sim_obj</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>    n_fish_fleets <span class="op">=</span> <span class="va">sim_obj</span><span class="op">$</span><span class="va">n_fish_fleets</span>,</span>
<span>    n_srv_fleets <span class="op">=</span> <span class="va">sim_obj</span><span class="op">$</span><span class="va">n_srv_fleets</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Recruitment setup</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Rec.html">Setup_Mod_Rec</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    do_rec_bias_ramp <span class="op">=</span> <span class="fl">0</span>, <span class="co"># not doing bias ramp</span></span>
<span>    sigmaR_switch <span class="op">=</span> <span class="fl">1</span>, <span class="co"># when to switch from early to late sigmaR (switch in first year)</span></span>
<span>    ln_sigmaR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> , <span class="fl">2</span><span class="op">)</span>, <span class="co"># 2 values for early and late sigma</span></span>
<span>    rec_model <span class="op">=</span> <span class="st">"mean_rec"</span>,</span>
<span>    sigmaR_spec <span class="op">=</span> <span class="st">"fix"</span>, <span class="co"># fix early sigmaR and late sigmaR</span></span>
<span>    init_age_strc <span class="op">=</span> <span class="fl">0</span>, <span class="co"># geometric series to derive initial age structure</span></span>
<span>    equil_init_age_strc <span class="op">=</span> <span class="fl">2</span>, <span class="co"># estimating all intial age deviations</span></span>
<span>    ln_global_R0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Biological setup</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Biologicals.html">Setup_Mod_Biologicals</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># Data inputs</span></span>
<span>    WAA <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">WAA</span>,</span>
<span>    MatAA <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">MatAA</span>,</span>
<span>    WAA_fish <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">WAA_fish</span>,</span>
<span>    WAA_srv <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">WAA_srv</span>,</span>
<span>    fit_lengths <span class="op">=</span> <span class="fl">0</span>, <span class="co"># not fitting lengths</span></span>
<span>    AgeingError <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">AgeingError</span>,</span>
<span>    M_spec <span class="op">=</span> <span class="st">"fix"</span>,     <span class="co"># fixing natural mortality</span></span>
<span>    Fixed_natmort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0.3</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Movement and tagging</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Tagging.html">Setup_Mod_Tagging</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>, UseTagging <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Movement.html">Setup_Mod_Movement</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    use_fixed_movement <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Fixed_Movement <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    do_recruits_move <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Fishery catch &amp; fishing mortality</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Catch_and_F.html">Setup_Mod_Catch_and_F</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># Data inputs</span></span>
<span>    ObsCatch <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsCatch</span>,</span>
<span>    Catch_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    UseCatch <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseCatch</span>,</span>
<span>    <span class="co"># Model options</span></span>
<span>    Use_F_pen <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    sigmaC_spec <span class="op">=</span> <span class="st">"fix"</span>,</span>
<span>    <span class="co"># Fixing sigma C and F</span></span>
<span>    ln_sigmaC <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ln_sigmaC</span>,</span>
<span>    ln_sigmaF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Survey selectivity and catchability</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_FishIdx_and_Comps.html">Setup_Mod_FishIdx_and_Comps</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># Data inputs</span></span>
<span>    ObsFishIdx <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsFishIdx</span>,</span>
<span>    ObsFishIdx_SE <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsFishIdx_SE</span>,</span>
<span>    UseFishIdx <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseFishIdx</span>,</span>
<span>    ObsFishAgeComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsFishAgeComps</span>,</span>
<span>    ObsFishLenComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsFishLenComps</span>,</span>
<span>    UseFishAgeComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseFishAgeComps</span>,</span>
<span>    UseFishLenComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseFishLenComps</span>,</span>
<span>    ISS_FishAgeComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ISS_FishAgeComps</span>,</span>
<span>    ISS_FishLenComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ISS_FishLenComps</span>,</span>
<span>    <span class="co"># Model options</span></span>
<span>    fish_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biom"</span><span class="op">)</span>,</span>
<span>    FishAgeComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span><span class="op">)</span>,</span>
<span>    FishLenComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>    FishAgeComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_Year_1-terminal_Fleet_1"</span><span class="op">)</span>,</span>
<span>    FishLenComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Year_1-terminal_Fleet_1"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Survey indices and compositions</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_SrvIdx_and_Comps.html">Setup_Mod_SrvIdx_and_Comps</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># Data inputs</span></span>
<span>    ObsSrvIdx <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsSrvIdx</span>,</span>
<span>    ObsSrvIdx_SE <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsSrvIdx_SE</span>,</span>
<span>    UseSrvIdx <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseSrvIdx</span>,</span>
<span>    ObsSrvAgeComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsSrvAgeComps</span>,</span>
<span>    ObsSrvLenComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ObsSrvLenComps</span>,</span>
<span>    UseSrvAgeComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseSrvAgeComps</span>,</span>
<span>    UseSrvLenComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">UseSrvLenComps</span>,</span>
<span>    ISS_SrvAgeComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ISS_SrvAgeComps</span>,</span>
<span>    ISS_SrvLenComps <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ISS_SrvLenComps</span>,</span>
<span>    <span class="co"># Model options</span></span>
<span>    srv_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biom"</span><span class="op">)</span>,</span>
<span>    SrvAgeComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span><span class="op">)</span>,</span>
<span>    SrvLenComps_LikeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>    SrvAgeComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_Year_1-terminal_Fleet_1"</span><span class="op">)</span>,</span>
<span>    SrvLenComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Year_1-terminal_Fleet_1"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Fishery selectivity and catchability</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Fishsel_and_Q.html">Setup_Mod_Fishsel_and_Q</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># Model options</span></span>
<span>    fish_sel_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gamma_Fleet_1"</span><span class="op">)</span>, <span class="co"># fishery selex model (NOTE: ASSUMES DOMED)</span></span>
<span>    fish_fixed_sel_pars_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span><span class="op">)</span>, <span class="co"># whether to estiamte all fixed effects for fishery selectivity</span></span>
<span>    fish_q_spec <span class="op">=</span> <span class="st">"est_all"</span> <span class="co"># estimate fishery q</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Survey selectivity and catchability</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Srvsel_and_Q.html">Setup_Mod_Srvsel_and_Q</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    <span class="co"># Model options</span></span>
<span>    srv_sel_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logist2_Fleet_1"</span><span class="op">)</span>, <span class="co"># survey selectivity form</span></span>
<span>    srv_fixed_sel_pars_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span><span class="op">)</span>, <span class="co"># whether to estimate all fixed effects for survey selectivity</span></span>
<span>    srv_q_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span><span class="op">)</span>  <span class="co"># whether to estiamte all fixed effects for survey catchability</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Data weighting</span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Weighting.html">Setup_Mod_Weighting</a></span><span class="op">(</span></span>
<span>    input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>    Wt_Catch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_FishIdx <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_SrvIdx <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_Rec <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_F <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    Wt_Tagging <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    Wt_FishAgeComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Wt_FishLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Wt_SrvAgeComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                      <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Wt_SrvLenComps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                      <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-cross-test-analysis">Run Cross-Test Analysis<a class="anchor" aria-label="anchor" href="#run-cross-test-analysis"></a>
</h3>
<p>After setting up the EM, we can run the cross-test by fitting the
model to each simulated dataset.<br>
We store the resulting spawning stock biomass (SSB) estimates for
comparison with the OM.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssb_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">$</span><span class="va">n_yrs</span>, <span class="va">sim_list</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span><span class="op">)</span> <span class="co"># storage container</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">sim_obj</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu">setup_em</span><span class="op">(</span><span class="va">sim_obj</span>, sim <span class="op">=</span> <span class="va">i</span><span class="op">)</span> <span class="co"># setup EM</span></span>
<span></span>
<span>  <span class="co"># fit model</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                     <span class="va">input_list</span><span class="op">$</span><span class="va">par</span>,</span>
<span>                     <span class="va">input_list</span><span class="op">$</span><span class="va">map</span>,</span>
<span>                     random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                     silent <span class="op">=</span> <span class="cn">T</span></span>
<span>                     <span class="op">)</span></span>
<span></span>
<span>  <span class="va">ssb_results</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">SSB</span> <span class="co"># save results</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># end i loop</span></span></code></pre></div>
<p>As expected, the simulation cross-test demonstrates that
misspecification of fishery selectivity leads to biased estimates of key
population quantities. In particular, spawning stock biomass (SSB) is
positively biased because the EM incorrectly assumes dome-shaped
selectivity while the true OM selectivity is logistic, treating a
portion of the population as invulnerable to the fishery, leading to an
overestimation of stock size.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process SSB results</span></span>
<span><span class="va">ssb_df_res</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">ssb_results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Var1</span>, Sim <span class="op">=</span> <span class="va">Var2</span>, Est <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">sim_obj</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Sim <span class="op">=</span> <span class="va">Var3</span>, True <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Sim"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>RE <span class="op">=</span> <span class="op">(</span><span class="va">Est</span> <span class="op">-</span> <span class="va">True</span><span class="op">)</span> <span class="op">/</span> <span class="va">True</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">RE</span><span class="op">)</span>,</span>
<span>                   lwr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">RE</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                   upr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">RE</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ssb_df_res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">median</span>, ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, lwd <span class="op">=</span> <span class="fl">1.3</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Year'</span>, y <span class="op">=</span> <span class="st">'SSB Relative Error (%)'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/l_ssb_cross_test.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="self-testing">Self Testing<a class="anchor" aria-label="anchor" href="#self-testing"></a>
</h2>
<p>In addition to simulation cross-testing, users can also conduct
self-tests. Simulation self-testing is useful because it helps evaluate
model robustness in the context of parameter identifiability. Ideally, a
simulation self-test should return unbiased parameter estimates on
average. If it does not, this generally indicates a lack of
identifiability for some parameters given the available data. Here, we
demonstrate simulation self-testing using Dusky Rockfish as an example.
Simulation self-testing is facilitated by the helper function
<code>simulation_self_test</code>, which allows users to conduct
simulations using a fitted <code>SPoRC</code> model (i.e., providing
<code>data</code>, <code>parameters</code>, <code>mapping</code>,
<code>rep</code>, and <code>sd_rep</code>). To reduce computation time,
we parallelize the simulations across 8 cores and output estimates of
SSB and recruitment.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in dusky rockfish model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dusky_rtmb_model"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using Dusky Rockfish as example to conduct simulation self-testing</span></span>
<span><span class="va">self_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulation_self_test.html">simulation_self_test</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">parameters</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">mapping</span>,</span>
<span>  random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep <span class="op">=</span> <span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">rep</span>,</span>
<span>  sd_rep <span class="op">=</span> <span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">sdrep</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>, </span>
<span>  newton_loops <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  do_sdrep <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  do_par <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  output_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SSB"</span>, <span class="st">"Rec"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The self-test indicates that the model is generally able to recover
the overall trends well. However, some biases manifest in the early and
late periods, likely due to uncertainty in catch data in the early
period and a lack of age composition data during these periods.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process self test results</span></span>
<span><span class="va">self_test_res</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">self_test</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Sim <span class="op">=</span> <span class="va">Var3</span>, Est <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Best <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="st">"Year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="st">'SSB'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">self_test</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Sim <span class="op">=</span> <span class="va">Var3</span>, Est <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">dusky_rtmb_model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Best <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>                       by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="st">"Year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="st">'Rec'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="va">self_test_res</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Est</span>, group <span class="op">=</span> <span class="va">Sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="va">self_test_res</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Best</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'red'</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Type</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/l_ssb_rec_self_test.png"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
